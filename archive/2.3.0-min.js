/*!
 * Process Queue v2.3
 *
 * Copyright 2013 Xingchen Hong
 *
 * Date: 2013-06-03 19:48
 */
!function(a,b,c,d){function e(a){var b=(new Date).getTime()/1e3,c=parseInt(b,10);return a?b:Math.round(1e3*(b-c))/1e3+" "+c}function g(){return e(!0)-f}function h(a){c.log("@"+g().toString(10).substr(0,16)+", PQUEUE_2: "+a)}function i(a){c.warn("@"+g().toString(10).substr(0,16)+", PQUEUE_2: "+a)}function j(b,c,d,e){"use strict";return h("Instantiating new process queue."),"object"!=typeof c?(i("Invalid argument[1]. Expecting an Object."),i("Returning NULL."),void 0):(h("Generating new process queue object."),new function(){function n(){return j.pc>=j.processes.length}function o(a){j.error=!0,j.errorMessage.push("string"==typeof a?a:"")}function p(){for(;j.errorMessage.length>0;)i(j.errorMessage.shift())}function q(a){return"function"==typeof a}function r(a){return a===k}function s(a){return a===l}var f=this,g="object"==typeof b?b:null,j={calling:!1,ticking:!1,error:!1,errorMessage:[],autoProceed:!1,name:String(e?e:(new Date).getTime()),processes:[],processIndex:[],pc:0},m={};this.tick=function(){if(j.ticking)return i("Already ticking."),void 0;if(j.ticking=!0,h("["+j.name+"].tick"),j.autoProceed=!1,j.error!==!1)p();else if(h("PC = "+j.pc),n())o("PC overflow");else{var b=j.processes[j.pc];if(q(b))if(r(b))h("halt");else if(s(b))h("barrier");else{++j.pc,j.autoProceed=!0,h(">>"+b.name);var c={heap:m,heap_dump:function(){var a="";for(var b in m)""!==a&&(a+=", \n"),a+=b+":"+m[b];return"{\n"+a+"\n}"},wait:function(b){if(j.calling===!0&&j.autoProceed===!0)switch(typeof b){case"number":a.setTimeout(c.walk,b);case"undefined":j.autoProceed=!1}},walk:function(){j.calling===!1&&j.autoProceed===!1&&(j.autoProceed=!0,f.tick())},pc:{increment:function(){++j.pc},decrement:function(){--j.pc},offset:function(a){j.pc+=Number(a)||0},"goto":function(a){j.pc=Number(a)||-1},locate:function(a){return j.processIndex[String(a)]||-1}},parent:g};j.calling=!0;try{b.call(c,c)}catch(d){o(d.message)}j.calling=!1}else o("invalid process")}j.ticking=!1,j.autoProceed===!0&&a.setTimeout(function(){f.tick()},0)};for(var t in c){var u=c[t],v=j.processes.length,w=u.name;j.processes.push(u),""!==w&&(j.processIndex[w]=v)}j.pc=parseInt(d,10)||0})}function k(){}function l(a){a.wait()}c===d&&(c={log:function(){},warn:function(){}});var f=e(!0);a.PQUEUE===d&&(a.PQUEUE=j,a.PQUEUE_HALT=k,a.PQUEUE_BARRIER=l)}(window,document,console);